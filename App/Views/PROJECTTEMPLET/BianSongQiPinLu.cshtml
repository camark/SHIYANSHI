@model Langben.DAL.PROJECTTEMPLET

@{
    ViewBag.title = "变送器-频率-引用误差";
    Layout = "~/Views/Shared/Edit.cshtml";
}
@using Common
@using Models

<div data-options="region:'north',border:false" style="height: 50px; overflow:hidden; padding:5px;">
    <div class="easyui-panel" title="" data-options="iconcls:'icon-search',fit:true" style="padding:5px; overflow:hidden;">
        <table>
            <tr>
                <td>
                    <a href="javascript:;" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" onclick="CreateTongDao()" id="btnDuoTongDao" style="display:none">增加通道</a>
                    <a href="javascript:;" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-save'" id="btnSave" onclick="Save()">保存检测项</a>
                    <a href="javascript:;" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-save'" id="btnReset" onclick="Reset()">重置检测项</a>

                    @*<a href="javascript:;" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-save'" id="btnSave_ITE" onclick="Save_ITE()">保存检测项</a>*@
                    <a href="javascript:;" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-save'" id="btnReset_ITE" onclick="Reset_ITE()">重置检测项</a>
                </td>
            </tr>
        </table>
    </div>
</div>

<input type="hidden" id="hideID" value="@ViewBag.ID" /><!--主键-->
<input type="hidden" id="hideRULEID" value="@ViewBag.RULEID" /><!--检测项-->
<input type="hidden" id="hideSCHEMEID" value="@ViewBag.SCHEMEID" /><!--方案编号-->
<input type="hidden" id="hidePREPARE_SCHEMEID" value="@ViewBag.PREPARE_SCHEMEID" /><!--预备方案ID-->
<input type="hidden" id="hideITEID" value="@ViewBag.ITEID" /><!--预备方案检测项ID-->

@if (Model != null && Model.HTMLVALUE != null && Model.HTMLVALUE.Trim() != "")
{
    <input type="hidden" id="hideHTMLVALUE" value="@Model.HTMLVALUE" />
}
else
{
    <input type="hidden" id="hideHTMLVALUE" value="" />
}
<div data-options="region:'center',title:'',iconCls:'icon-ok',border:false" style="padding:3px;" id="divHtml">

    @*<input type="hidden" id="rowindex" value="0" />*@
    <div class="mt10" id="tongdao">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tbl" id="tongdao_moban" style="display:none">
            <thead>
                <tr>
                    <td colspan="9">
                        通道：
                        <select class="my-combobox" name="" id="">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span>功率因数</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="9">
                        <div class="fl" style="margin-right:20px">
                            输入范围：(
                            <input name="" type="text" class="my-textbox tc" value="0.5C" style="width:30px">
                            -
                            <input name="" type="text" class="my-textbox tc" value="0.5L" style="width:30px">
                            )
                        </div>
                        <div class="fl" style="margin-right:20px">
                            输出范围：(
                            <input name="" type="text" class="my-textbox tc" value="4" style="width:30px">
                            -
                            <input name="" type="text" class="my-textbox tc" value="20" style="width:30px">
                            ) <select class="my-combobox" name="" id="">
                                <option value="mA">mA</option>
                                <option value="V">V</option>
                            </select>
                        </div>
                        <div class="fl" style="margin-right:20px;">
                            U<sub>n</sub> =
                            <input name="" type="text" class="my-textbox tc" value="100" style="width:40px">
                            <select class="my-combobox" name="" id="">
                                <option value="V">V</option>
                                <option value="MV">MV</option>
                                <option value="KV">KV</option>
                                <option value="mV">mV</option>
                                <option value="μV">μV</option>
                            </select>
                        </div>
                        <div class="fl" style="margin-right:20px; ">
                            I<sub>n</sub> =
                            <input name="" type="text" class="my-textbox tc" value="5" style="width:40px">
                            <select class="my-combobox" name="" id="">
                                <option value="A">A</option>
                                <option value="KA">KA</option>
                                <option value="mA">mA</option>
                                <option value="μA">μA</option>
                                <option value="nA">nA</option>
                                <option value="pA">pA</option>
                            </select>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th align="center" width="100">测试量</th>
                    <th align="center" width="100"> 等级</th>
                    <th align="center" width="120"> 测量点</th>

                    <th align="center" width="120">
                        二次输入标准值<br>
                    </th>
                    <th align="center" width="100">
                        标准输出值<br>
                        <select class="my-combobox" name="" id="">
                            <option value="MA">MA</option>
                            <option value="pA">V</option>
                        </select>
                    </th>
                    <th align="center" width="100">
                        实际输出值<br>
                        <select class="my-combobox" name="" id="">
                            <option value="MA">MA</option>
                            <option value="pA">V</option>
                        </select>
                    </th>
                    <th align="center" width="100">
                        引用误差<br>
                        (%)
                    </th>
                    <th align="center">
                        校准结果的不确定度<br>
                        U(K =
                        <select class="my-combobox" name="state">
                            <option value="">2 </option>
                            <option value="">3</option>
                            <option value="">√3</option>
                        </select>
                        )
                    </th>
                </tr>
            </thead>

            <tbody id="tbody_moban_1">
                <tr>
                    <td align="center" width="100">cosφ</td>
                    <td align="center" width="100">
                        <input name="" type="text" class="my-textbox tr" value="0.0" style="width:70px" onblur="JS1(this)" tableid="tongdao_1">
                        级
                    </td>
                    <td colspan="7" style="padding:0">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="subtbl">
                            <tbody id="tbody_moban">
                                <tr rowindex="1">
                                    <td rowspan="1" align="right" width="120">
                                        <input class="my-textbox input-width" value="0.5" id="OUTPUT_VALUE_1_1_0" name="OUTPUT_VALUE" onblur="blurValue(this)" type="text"><span>C</span>
                                    </td>
                                    <td rowspan="1" align="right" width="120"> <input class="my-textbox input-width" value="60" id="READ_VALUE_1_1_0" name="READ_VALUE" onblur="blurValue(this)" type="text"><span>°</span></td>
                                    <td rowspan="1" align="right" width="100"> <input class="my-textbox input-width" value="" id="ACTUAL_OUTPUT_VALUE_1_1_0" name="ACTUAL_OUTPUT_VALUE" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right" width="100"> <input class="my-textbox input-width" value="" id="SHIJISHUCHUZHI_1_1_0" name="SHIJISHUCHUZHI" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right" width="100"> <input class="my-textbox input-width" value="" id="RELATIVE_ERROR_1_1_0" name="RELATIVE_ERROR" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="UNCERTAINTY_DEGREE_1_1_0" name="UNCERTAINTY_DEGREE" onblur="blurValue(this)" type="text"></td>
                                </tr>
                                <tr rowindex="2">
                                    <td rowspan="1" align="right">
                                        <input class="my-textbox input-width" value="0.8" id="OUTPUT_VALUE_1_2_0" name="OUTPUT_VALUE" onblur="blurValue(this)" type="text"><span>C</span>
                                    </td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="30" id="READ_VALUE_1_2_0" name="READ_VALUE" onblur="blurValue(this)" type="text"><span>°</span></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="ACTUAL_OUTPUT_VALUE_1_2_0" name="ACTUAL_OUTPUT_VALUE" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="SHIJISHUCHUZHI_1_2_0" name="SHIJISHUCHUZHI" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="RELATIVE_ERROR_1_2_0" name="RELATIVE_ERROR" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="UNCERTAINTY_DEGREE_1_2_0" name="UNCERTAINTY_DEGREE" onblur="blurValue(this)" type="text"></td>
                                </tr>
                                <tr rowindex="3">
                                    <td rowspan="1" align="right">
                                        <input class="my-textbox input-width" value="1.0" id="OUTPUT_VALUE_1_3_0" name="OUTPUT_VALUE" onblur="blurValue(this)" type="text"><span></span>
                                    </td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="0" id="READ_VALUE_1_3_0" name="READ_VALUE" onblur="blurValue(this)" type="text"><span>°</span></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="ACTUAL_OUTPUT_VALUE_1_3_0" name="ACTUAL_OUTPUT_VALUE" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="SHIJISHUCHUZHI_1_3_0" name="SHIJISHUCHUZHI" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="RELATIVE_ERROR_1_3_0" name="RELATIVE_ERROR" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="UNCERTAINTY_DEGREE_1_3_0" name="UNCERTAINTY_DEGREE" onblur="blurValue(this)" type="text"></td>
                                </tr>
                                <tr rowindex="4">
                                    <td rowspan="1" align="right">
                                        <input class="my-textbox input-width" value="0.8" id="OUTPUT_VALUE_1_4_0" name="OUTPUT_VALUE" onblur="blurValue(this)" type="text"><span>C</span>
                                    </td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="330" id="READ_VALUE_1_4_0" name="READ_VALUE" onblur="blurValue(this)" type="text"><span>°</span></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="ACTUAL_OUTPUT_VALUE_1_4_0" name="ACTUAL_OUTPUT_VALUE" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="SHIJISHUCHUZHI_1_4_0" name="SHIJISHUCHUZHI" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="RELATIVE_ERROR_1_4_0" name="RELATIVE_ERROR" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="UNCERTAINTY_DEGREE_1_4_0" name="UNCERTAINTY_DEGREE" onblur="blurValue(this)" type="text"></td>
                                </tr>
                                <tr rowindex="5">
                                    <td rowspan="1" align="right">
                                        <input class="my-textbox input-width" value="0.5" id="OUTPUT_VALUE_1_5_0" name="OUTPUT_VALUE" onblur="blurValue(this)" type="text"><span>C</span>
                                    </td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="360" id="READ_VALUE_1_5_0" name="READ_VALUE" onblur="blurValue(this)" type="text"><span>°</span></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="ACTUAL_OUTPUT_VALUE_1_5_0" name="ACTUAL_OUTPUT_VALUE" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="SHIJISHUCHUZHI_1_5_0" name="SHIJISHUCHUZHI" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="RELATIVE_ERROR_1_5_0" name="RELATIVE_ERROR" onblur="blurValue(this)" type="text"></td>
                                    <td rowspan="1" align="right"> <input class="my-textbox input-width" value="" id="UNCERTAINTY_DEGREE_1_5_0" name="UNCERTAINTY_DEGREE" onblur="blurValue(this)" type="text"></td>
                                </tr>

                            </tbody>
                        </table>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="7">
                        <input type="hidden" id="hideLiangChengShuLiang" value="5" />
                        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" id="btnAddLiangCheng">增加空行</a>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="mt10">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tbl">

            <tr>
                <th width="40">注：</th>
                <td colspan="6">
                    <input type="text" class="my-textbox input-width" name="REMARK" data-options="multiline:true" style="height:30px; width:95%" id="REMARK">
                </td>
            </tr>
            <tr>
                <th width="40">结论：</th>
                <td colspan="6">
                    <input type="text" class="my-textbox input-width" name="CONCLUSION" data-options="multiline:true" style="height:30px; width:95%" id="CONCLUSION">
                </td>
            </tr>

        </table>
    </div>
    <input type="hidden" id="hideDangQianTongDao" value="0" />
    <input type="hidden" id="hideTongDaoShuLiang" value="0" />
    <input type="hidden" id="txtPoint" value="1" />
    <input type="hidden" id="txtNumber" value="1" />
</div>

<script src="/Scripts/JScript-JianCeXiang-Common.js"></script>
<script type="text/javascript" language="javascript">
    //var RuleID = $("#hideRULEID").val();//检测项目ID
    //var RuleAttribute = GetRuleAttributeByRuleID(RuleID);
    // $Tongdao_moban//模板
    //设置当前操作通道
    function set(tbodyIndex) {

        CreateRow();
        $("#hideDangQianTongDao").val(tbodyIndex);

    }
    //增加量程
    function CreateRow() {

        var hideDangQianTongDao = $("#hideDangQianTongDao").val();//当前操作第几通道
        var LiangChengShuLiang = $("#tongdao_" + hideDangQianTongDao).find("#hideLiangChengShuLiang").val();//某个通道量程数量
        LiangChengShuLiang++;
        var rowspanIdx = $("#txtPoint").val();     //检测点数
        txtNumber = $("#txtNumber").val(); //量程
        var standardValue = "";
        var htmlString = [];
        var rowLength = $("#tbody_" + hideDangQianTongDao + " tr").length;

        var lianChengID = hideDangQianTongDao + "_" + LiangChengShuLiang;//（量程ID）第几个通道_第几个量程
        for (var rowidx = 0; rowidx < rowspanIdx; rowidx++) {
            rowLength++;
            htmlString.push("<tr rowindex='" + rowLength + "'>");

            var rowspan;
            var name;
            var id;
            var txtVal;
            var ddlhtml;
            var ddlVal;
            var HangHaoID = lianChengID + "_" + rowidx;//（行号ID)量程ID_第几行
            if (rowidx == 0) {
                //需要合并的列
            }

            //输出示值

            var changerHTML = "onblur=''";
            //测量点
            htmlString.push(SetTDHtml(1, "OUTPUT_VALUE", HangHaoID, rowidx, "", "<span>C</span>"));
            //二次输入标准值
            htmlString.push(SetTDHtml(1, "READ_VALUE", HangHaoID, rowidx, "", "<span>°</span>"));
            //标准输出值
            htmlString.push(SetTDHtml(1, "ACTUAL_OUTPUT_VALUE", HangHaoID, rowidx, ""));
            //实际输出值
            htmlString.push(SetTDHtml(1, "SHIJISHUCHUZHI", HangHaoID, rowidx, ""));
            //引用误差
            htmlString.push(SetTDHtml(1, "RELATIVE_ERROR", HangHaoID, rowidx, ""));
            //校准结果的不确定度
            htmlString.push(SetTDHtml(1, "UNCERTAINTY_DEGREE", HangHaoID, rowidx, ""));
            htmlString.push("</tr>");
        }
        htmlString = htmlString.join("");
        //var tagRow = $("#tbody_" + tableIdx).append(htmlString);

        var tagRow = $("#tongdao_" + hideDangQianTongDao).find("#tbody_" + hideDangQianTongDao).append(htmlString);
        $.parser.parse(tagRow);//渲染easyui组建
        //$('#dlg').window('close');
        $("#tongdao_" + hideDangQianTongDao).find("#hideLiangChengShuLiang").val(LiangChengShuLiang)
    }

    //离开事件，用于计算
    function blurValue(obj) {
        LianDongShiJiZhi(obj);
    }
    //联动标准值
    //输出实际值计算：【选用电阻阻值】有数值时，输出实际值= 读数值 / 选用电阻阻值；【选用电阻阻值】没有数值时，输出实际值=读数值
    function LianDongShiJiZhi(obj) {

        if (obj.name == "RESISTANCE" && obj.value.trim() != "")//选用电阻阻值变更
        {

            id = obj.id.replace(obj.name, "") + "_";
            $("input[name=READ_VALUE]").each(function (a, b) {//读数值
                if (b.id.indexOf(id) >= 0 && b.value.trim() != "") {
                    var hhID = b.id.replace(b.name, "");//行号
                    var shijizhiID = "#ACTUAL_OUTPUT_VALUE" + hhID;//输出实际值ID
                    $(shijizhiID).val(CalculateShiJiZhi(obj.value.trim(), b.value.trim()));
                }
            });
        }
        else if (obj.name == "READ_VALUE")//读数值
        {
            var DZID = obj.id.replace(obj.name, "");
            DZID = DZID.substr(0, DZID.lastIndexOf("_"));
            var hhID = obj.id.replace(obj.name, "");//行号
            var shijizhiID = "#ACTUAL_OUTPUT_VALUE" + hhID;//输出实际值ID
            var DianZuID = "#RESISTANCE" + DZID;//电阻ID
            $(shijizhiID).val(CalculateShiJiZhi($(DianZuID).val(), obj.value.trim()));
        }
    }
    //计算输出实际值
    function CalculateShiJiZhi(DianZu, DuShuZhi) {
        if (DianZu == "" || DuShuZhi == "") {//【选用电阻阻值】没有数值时，输出实际值=读数值
            return DuShuZhi;
        }
        else if (DianZu.trim() == "0") {
            return "";
        }
        else//【选用电阻阻值】有数值时，输出实际值= 读数值 / 选用电阻阻值
        {
            var value = parseFloat(DuShuZhi.trim()) / parseFloat(DianZu.trim());
            return value;
        }
    }


</script>


