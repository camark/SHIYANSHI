<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width" />
    <title>不确定度评定过程</title>
    <link id="easyuiTheme" href="/Res/easyui/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <link href="/Res/easyui/themes/default/easyui.css" rel="stylesheet" />
    <link href="/Res/easyui/themes/icon.css" rel="stylesheet" />
    <link href="/Content/default.css" rel="stylesheet" />
    <link href="/Content/StyleSheet.css" rel="stylesheet" />
    <script src="/Scripts/jquery.min.js"></script>
    <script src="/Scripts/JScriptCommon.js"></script>
    <script src="/Res/easyui/jquery.easyui.min.js"></script>
    <script src="/Res/easyui/locale/easyui-lang-zh_CN.js"></script>
    <script src="/Scripts/jquery.validate.js"></script>
    <script src="/Scripts/jquery.validate.unobtrusive.min.js"></script>
</head>
<body class="easyui-layout">
    <div data-options="region:'north',border:false" style="height: 50px; overflow:hidden; padding:5px;">
        <div class="easyui-panel" title="" data-options="iconcls:'icon-search',fit:true" style="padding:5px; overflow:hidden;">
            <table width="500">
                <tr>
                    <td>
                        xxxx不确定度的评定
                    </td>
                    <td>
                        <select class="my-combobox" name="" id="">
                            <option value=""> </option>
                            <option value="">评定项</option>
                            <option value="">量程</option>
                            <option value="">档位</option>
                            <option value="">测量范围</option>
                        </select>
                        <input class="my-textbox " type="text" name="" id="" value="" style="width:100px">
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <!--评定点 -->
    <div data-options="region:'center',title:'',iconCls:'icon-ok',border:false" style="padding:3px;">
        <div class="mt10">
            <table width="95%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td nowrap valign="top" width="60">评定点：</td>
                    <td valign="top">
                        <ul class="clear mb10">
                            <li class="fl mr10">
                                <select class="my-combobox" name="" id="">
                                    <option value=""> </option>
                                    <option value="">额定电压</option>
                                    <option value="">负载</option>
                                    <option value="">功率因数</option>
                                </select>
                                <input class="my-textbox " type="text" name="" id="" value="" style="width:100px">
                                <select class="my-combobox" name="" id="">
                                    <option value="V">V</option>
                                    <option value="MV">MV</option>
                                    <option value="KV">KV</option>
                                    <option value="mV">mV</option>
                                    <option value="μV">μV</option>
                                </select>
                            </li>
                            <li class="fl mr10">
                                <input type="button" class="my-btn" value="添 加" onclick="linkButton.add(this)" />
                                <input type="button" class="my-btn" value="移 除" onclick="linkButton.del(this)" />
                            </li>
                        </ul>
                    </td>
                </tr>
            </table>
        </div>
        <!--/评定点 -->
        <!--A类 -->
        <div class="mt10">
            <h2 class="f14 mt10 "> （1）不确定度的A类评定 </h2>
        </div>
        <div class="mt10" id="tongdao">
            <div>
                <i>U</i><small>A</small> =
                <input class="my-textbox " value="" style="width:200px" name="" id="txtBuQueDingA"> <input class="my-textbox " value="" style="width:100px" name="" id="txtValue" onblur="calculate()">
            </div>
            <table border="0" cellspacing="0" cellpadding="0" class="tbl mt10" id="tongdao_moban">
                <thead>
                    <tr>
                        <th align="center" width="150">y<sub>1</sub>/y<sub>6</sub></th>
                        <th align="center" width="150">y<sub>2</sub>/y<sub>7</sub></th>
                        <th align="center" width="150">y<sub>3</sub>/y<sub>8</sub></th>
                        <th align="center" width="150">y<sub>4</sub>/y<sub>9</sub></th>
                        <th align="center" width="150">y<sub>5</sub>/y<sub>10</sub></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                    </tr>
                    <tr>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%" onblur="calculate()"></td>
                    </tr>
                </tbody>

            </table>
        </div>

        <!--/A类 -->
        <!--B类 -->
        <div class="mt10">
            <h2 class="f14 mt10 "> （2）不确定度的B类评定 </h2>
        </div>
        <div class="mt10">
            <div>
                <i>U</i><small>B</small> =
                <input class="my-textbox " value="" style="width:200px" name="" id="txtBuQueDingB"> <input class="my-textbox " value="" style="width:100px" name="" id="txtValueB" onblur="calculateB()">
            </div>
            <table border="0" cellspacing="0" cellpadding="0" class="tbl mt10" id="tongdao_B">
                <thead>
                    <tr>
                        <th align="center" width="150">评定项/范围</th>
                        <th align="center" width="150">误差来源</th>
                        <th align="center" width="150">误差限</th>
                        <th align="center" width="150">误差分布状况</th>
                        <th align="center" width="100"><i>k</i></th>
                        <th align="center" width="150">不确定度Ui</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td align="center"><input class="my-textbox " type="text" name="" id="" value="" style="width:95%"></td>
                        <td align="center">
                            <input class="my-textbox input-width" type="text" name="" id="" value="">
                            u<span id="sourceNum">1</span>
                        </td>
                        <td align="center">
                            <input class="my-textbox input-width" type="text" name="" id="" value="">
                            <input class="my-textbox " type="text" name="" id="" value="" style="width:40px">
                        </td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value="" style="width:95%"></td>
                        <td align="center"><input class="my-textbox input-width" type="text" name="" id="" value=""></td>
                        <td align="center">
                            <input class="my-textbox input-width" type="text" name="" id="" value="" onblur="calculateB()">
                            <input class="my-textbox " type="text" name="" id="" value="" style="width:40px">
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="6"><a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" onclick="addRow(this)">增加</a> <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-search'" onclick="">选择</a> <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-reload'" onclick="resetRow()">重置</a></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!--/B类 -->
        <!--合成不确定度评定 -->
        <div class="mt10">
            <h2 class="f14 mt10 "> （3）合成不确定度评定 </h2>
            <div class="mt10">
                <div>
                    <i>U</i><small>c</small> =
                    <input class="my-textbox " value="" style="width:300px" id="txtBuQueDingC">
                </div>
            </div>
        </div>
        <!--合成不确定度评定 -->
        <!--扩展不确定度评定 -->
        <div class="mt10">
            <h2 class="f14 mt10 " style=" display:inherit"> （4）合成不确定度评定 </h2>
            (k =
            <select class="my-combobox" name="ddlSelectD" id="ddlSelectD" onchange="caculateD()">
                <option value="2">2 </option>
                <option value="3">3</option>
                <option value="√3">√3</option>
            </select>
            )
            <div class="mt10">
                <div>
                    <i>U</i><small>rel</small> =
                    <input class="my-textbox " value="" style="width:300px" id="txtvalueD">
                </div>
            </div>
        </div>
        <!--扩展不确定度评定 -->
        <!--测量结果报告 -->
        <div class="mt10">
            <h2 class="f14 mt10 "> （5）测量结果报告 </h2>

            <div class="mt10">
                <div>
                    扩展不确定度为：
                    <input class="my-textbox " value="" style="width:300px" id="txtValueE">
                </div>
            </div>
        </div>
        <!--测量结果报告 -->


        <div class="mt10 form-foot"><input type="button" class="my-btn" value="保 存" /> <input type="button" class="my-btn" value="取 消" /></div>
    </div>
    <script type="text/javascript" language="javascript">
        //添加评定点
        var linkButton = {
            add: function (obj) {
                var newRow = " <ul class=\"clear mb10\">" + $(obj).parents('div ul').html() + "</ul>";
                var parDiv = $(obj).parents('div ul').parent()
                var newobj = $(parDiv).append(newRow);
                // $.parser.parse();
                // $.parser.parse();
            },
            del: function (obj) {
                var row = $(obj).parents('div ul');
                if ($(row).parent().children().length > 1)
                    $(row).remove();
                else
                    alert('就剩一行了你还删除呀？');
            }
        }
        //B类增加行
        var idx = 1;
        var addRow = function (obj) {

            var trNew = $('#tongdao_B tbody').find('tr:last').clone();
            idx++;
            $(trNew).children().eq(1).find('span').text(idx)
            $(trNew).children().eq(5).find('input').eq(0).val("");
            $("#tongdao_B tbody").append(trNew);
        }
        //清空增加的行
        function resetRow() {
            //$("#tongdao_B tbody tr:not(:first)").empty();
            $("#tongdao_B tbody tr:not(:first)").remove();
            idx = 1;

        }
        function getData() {
            var data = "";
            $("#tongdao_moban tr:not(:first)").each(function () {
                $($(this).children()).each(function () {
                    if ($(this).find('input').val() != "")
                        data += $(this).find('input').val() + ",";
                })

            })
            if (data.lastIndexOf(",") > -1)
                data = data.substring(0, data.length - 1);
            return data;
        }
        function calculate() {
            var x = getData();
            x = x.replace(' ', '');
            var arr = x.split(',');
            if (arr.length == 1) return false;
            var lcm = 0;
            var flag = false;
            var total = 0;
            for (var j = 0; j < arr.length; j++) {
                arr[j] = parseFloat(arr[j]);
                total += arr[j];
            }
            var mean = total / arr.length;
            mean = Math.round(mean * 10000) / 10000;
            var xm2 = 0;
            var srt = '';
            var srt1 = '';
            var srt2 = '';
            for (var j = 0; j < arr.length; j++) {
                xm2 += Math.pow((arr[j] - mean), 2);
                if (j == arr.length - 1) {
                    srt += '(' + arr[j] + '-' + mean + ')^2';
                    srt1 += '(' + (arr[j] - mean) + ')^2';
                    srt2 += '(' + Math.pow((arr[j] - mean), 2) + ')';
                } else {
                    srt += '(' + arr[j] + '-' + mean + ')^2+';
                    srt1 += '(' + (arr[j] - mean) + ')^2+';
                    srt2 += '(' + Math.pow((arr[j] - mean), 2) + ')+';
                }
            }
            var sd = xm2 / (arr.length - 1);
            var psd = xm2 / (arr.length);
            var sd1 = sd;
            var psd1 = psd;
            sd = Math.sqrt(sd);
            psd = Math.sqrt(psd);
            var sVariance = Math.pow(sd, 2);
            sVariance = Math.round(sVariance * 1000000) / 1000000;
            var pVariance = Math.pow(psd, 2);
            pVariance = Math.round(pVariance * 1000000) / 1000000;
            sd = Math.round(sd * 1000000) / 1000000;
            psd = Math.round(psd * 1000000) / 1000000;
            var v = $("#txtValue").val();
            $("#txtBuQueDingA").val(v == "" ? sd : parseFloat(sd) / parseFloat(v));

            calculateC();
        }

        function getDataB() {
            var data = "";
            $("#tongdao_B tr:not(:first)").each(function (idx) {
                if ($(this).children().eq(5).find('input').eq(0).val() != "" && $(this).children().eq(5).find('input').eq(0).val() != undefined)
                    data += $(this).children().eq(5).find('input').eq(0).val() + ","

            })
            if (data.lastIndexOf(",") > -1)
                data = data.substring(0, data.length - 1);
            return data;
        }

        function calculateB() {
            var x = getDataB();
            x = x.replace(' ', '');
            var arr = x.split(',');
            if (arr.length == 1) return false;
            var lcm = 0;
            var flag = false;
            var total = 0;
            for (var j = 0; j < arr.length; j++) {
                total += Math.pow(parseFloat(arr[j]), 2);
            }

            //var mean = Math.sqrt(total / arr.length);
            var mean = Math.sqrt(total);
            mean = Math.round(mean * 10000) / 10000;
            var v = $("#txtValue").val();
            $("#txtBuQueDingB").val(v == "" ? mean : parseFloat(mean) / parseFloat(v));
            calculateC();
        }
        function calculateC() {
            var valueA = $("#txtBuQueDingA").val();
            var valueB = $("#txtBuQueDingB").val();
            if (valueB == "" || valueA == "") return false;
            var valueC = Math.pow(parseFloat(valueA), 2) + Math.pow(parseFloat(valueB), 2);
            $("#txtBuQueDingC").val(Math.sqrt(valueC));
            caculateD();
        }

        function caculateD() {
            var valueC = $("#txtBuQueDingC").val();
            var ddlValue = $("#ddlSelectD").val();
            $("#txtvalueD,#txtValueE").val(parseFloat(ddlValue) * parseFloat(valueC))
        }
    </script>

</body>
</html>
