<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width" />
    <title>标准电阻箱-相对误差</title>
    <link id="easyuiTheme" href="/Res/easyui/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <link href="/Res/easyui/themes/default/easyui.css" rel="stylesheet" />
    <link href="/Res/easyui/themes/icon.css" rel="stylesheet" />
    <link href="/Content/default.css" rel="stylesheet" />
    <link href="/Content/StyleSheet.css" rel="stylesheet" />
    <script src="/Scripts/jquery.min.js"></script>
    <script src="/Scripts/JScriptCommon.js"></script>
    <script src="/Res/easyui/jquery.easyui.min.js"></script>
    <script src="/Res/easyui/locale/easyui-lang-zh_CN.js"></script>
    <script src="/Scripts/jquery.validate.js"></script>
    <script src="/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="/Scripts/jianCeXiang.js"></script>
</head>
<body class="easyui-layout">
    <input type="hidden" id="rowindex" value="1" />
    <div data-options="region:'north',border:false" style="height: 50px; overflow:hidden; padding:5px;">
        <div class="easyui-panel" title="" data-options="iconcls:'icon-search',fit:true" style="padding:5px; overflow:hidden;">
            <table>
                <tr>
                    <td><a href="javascript:;" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" onclick="TongDao.addTongDao()">增加通道</a> <a href="javascript:;" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-save'">保存检测项</a></td>
                </tr>
            </table>
        </div>
    </div>
    <div data-options="region:'center',title:'',iconCls:'icon-ok',border:false" style="padding:3px;">
        <div class="mt10">
            <span>基本量程：</span>×

            <select class="my-combobox" name="state_1_" id="state_UNIT_1_" onchange="changeValue(this)">
                <option value="1000" selected>1000</option>
                <option value="100">100</option>
                <option value="10">10</option>
                <option value="1">1</option>
                <option value="0.1">0.1</option>
                <option value="0.01">0.01</option>
                <option value="0.001">0.001</option>
            </select>
        </div>
        <div class="mt10" id="tongdao">
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tbl" id="tongdao_dy_1">
                <thead>
                    <tr>
                        <th width="80" rowspan="3" align="center">序号</th>
                        <th colspan="3" align="center">
                            ×
                            <input class="my-textbox input-width" value="0.1" type="text" name="input" id="input"  onblur="calculate.ShiJiZhi(this)">
                            <select class="my-combobox" name="state_1_" id="state_UNIT_1_" onchange="changeValue(this)">
                                <option value="Ω" selected>Ω</option>
                                <option value="TΩ">TΩ</option>
                                <option value="GΩ">GΩ</option>
                                <option value="MΩ">MΩ</option>
                                <option value="kΩ">kΩ</option>
                                <option value="mΩ">mΩ</option>
                                <option value="μΩ">μΩ</option>
                            </select>
                        </th>
                        <th colspan="3" align="center">
                            ×
                            <input class="my-textbox input-width" value="" type="text" name="input2" id="input2" onblur="calculate.ShiJiZhi(this)">
                            <select class="my-combobox" name="state_1_3" id="state_1_2" onchange="changeValue(this)">
                                <option value="Ω" selected>Ω</option>
                                <option value="TΩ">TΩ</option>
                                <option value="GΩ">GΩ</option>
                                <option value="MΩ">MΩ</option>
                                <option value="kΩ">kΩ</option>
                                <option value="mΩ">mΩ</option>
                                <option value="μΩ">μΩ</option>
                            </select>
                        </th>
                    </tr>
                    <tr></tr>
                    <tr>
                        <th width="140" align="center">
                            相对修正值<br>
                            (
                            ×10-6
                            )
                        </th>
                        <th width="140" align="center">
                            实际值<br>
                            (
                            <select class="my-combobox" name="select" id="select" onchange="changeValue(this)">
                                <option value="Ω" selected>Ω</option>
                                <option value="TΩ">TΩ</option>
                                <option value="GΩ">GΩ</option>
                                <option value="MΩ">MΩ</option>
                                <option value="kΩ">kΩ</option>
                                <option value="mΩ">mΩ</option>
                                <option value="μΩ">μΩ</option>
                            </select>
                            )
                        </th>
                        <th width="140" align="center">误差 %</th>
                        <th width="140" align="center">
                            相对修正值<br>
                            (
                            ×10-6
                            )
                        </th>
                        <th width="140" align="center">
                            实际值<br>
                            (
                            <select class="my-combobox" name="select2" id="select2" onchange="changeValue(this)">
                                <option value="Ω" selected>Ω</option>
                                <option value="TΩ">TΩ</option>
                                <option value="GΩ">GΩ</option>
                                <option value="MΩ">MΩ</option>
                                <option value="kΩ">kΩ</option>
                                <option value="mΩ">mΩ</option>
                                <option value="μΩ">μΩ</option>
                            </select>
                            )
                        </th>
                        <th width="140" align="center">误差 %</th>
                    </tr>
                </thead>
                <tbody id="tbody_1">
                    <!--默认5行 -->
                    <tr>
                        <td align="center">1</td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="input3" id="input3" type="text" class="my-textbox tr" value=""   /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="input4" id="input4" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                    </tr>
                    <tr>
                        <td align="center">2</td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="input3" id="input3" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="input4" id="input4" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                    </tr>
                    <tr>
                        <td align="center">3</td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="input3" id="input3" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="input4" id="input4" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                    </tr>
                    <tr>
                        <td align="center">4</td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="input3" id="input3" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="input4" id="input4" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                    </tr>
                    <tr>
                        <td align="center">5</td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="input3" id="input3" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                        <td align="center"><input name="input4" id="input4" type="text" class="my-textbox tr" value="" onblur="calculate.ShiJiZhi(this)"/></td>
                        <td align="center"><input name="" id="" type="text" class="my-textbox tr" value="" /></td>
                    </tr>
                    <!--/默认5行 -->
                </tbody>
                <tr>
                    <td colspan="7" style="background:#F7F7F7"><a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" onclick=" $('#dlg').dialog('open');TongDao.getCurTongDaoIdx(this)">增加行数</a></td>
                </tr>
                <tr>
                    <td align="center" nowrap>允许误差 %</td>
                    <td align="right">±</td>

                    <td colspan="2"><input name="" id="" type="text" class="my-textbox " value="" /></td>
                    <td align="right">±</td>

                    <td colspan="2"><input name="" id="" type="text" class="my-textbox " value="" /></td>
                </tr>
            </table>
        </div>
        <div class="mt10">
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tbl">
                <tr>
                    <th width="60">注：</th>
                    <td colspan="6"><input class="easyui-textbox " name="" data-options="multiline:true" style="height:40px; width:95%" value=""></td>
                </tr>
                <tr>
                    <th>结论：</th>
                    <td colspan="6"><input class="easyui-textbox " name="" data-options="multiline:true" style="height:40px; width:95%"></td>
                </tr>
            </table>
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tbl mt10">
                <tbody id="tbody_2">
                    <tr>
                        <td align="center" width="50%"><input name="" id="" type="text" class="my-textbox tr" value="" style="width:96%" /></td>
                        <td>
                            <i>U</i><small>rel</small>(k =
                            <select class="my-combobox" name="ddlSelectD" id="ddlSelectD" onchange="caculateD()">
                                <option value="2">2 </option>
                                <option value="3">3</option>
                                <option value="√3">√3</option>
                            </select>
                            ) =
                            <input class="my-textbox " value="" style="width:300px" id="txtvalueD">
                            <input type="button" class="my-btn" value="计 算" onclick="calculate(this)" />
                        </td>
                    </tr>
                </tbody>
                <!--<tr>
                  <td colspan="8" style="background:#F7F7F7"><a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" onclick="addUrel()">增加不确定度计算行</a></td>
                </tr> -->
            </table>
        </div>
    </div>

    <!--增加行数弹层-->
    <div id="dlg" class="easyui-dialog" title="增加行数" closed="true" data-options="buttons: [{
					text:'确定',
					iconCls:'icon-ok',
					handler:function(){
						  return TongDao.addRow()
					}
				},{
					text:'取消',
					handler:function(){
                    $('#dlg').window('close');
         }
         }]" style="width:400px;height:200px;padding:10px">
        <table>
            <tr>
                <td width="100" align="right" height="100">增加的数量：</td>
                <td><input type="text" id="txtNumber" class="my-textbox  required " style="width:200px" /></td>
            </tr>
        </table>
    </div>
    <!--/增加量程弹层-->

    <script type="text/javascript" language="javascript">


        var rowNumber = 6;
        var index = 1;
        var currentindex = 1;
        var TongDao = {
            addTongDao: function () {
                var tongdao = $("#tongdao_dy_1").clone();
                this.setTongDaoIdx(index + 1);
                $("#tongdao").append($(tongdao).attr("id", "tongdao_dy_" + this.getTongDaoIdx()));
            },
            addRow: function () {

                var inputHtml = "<input name=\"\" id=\"\" type=\"text\" class=\"my-textbox tr\" value=\"\" onblur=\"calculate.ShiJiZhi(this)\"/>";
                var rows = $("#txtNumber").val();
                for (var i = 0; i < rows; i++) {
                    // var rowIdx = $("#tongdao_dy_" + currentindex + " tbody").eq(0).find('tr').last().children().eq(0).text();
                    rowNumber = (rowNumber + 1);
                    $("#tongdao_dy_" + currentindex + " tbody").eq(0).append("<tr>" +
                                                                                  "<td align=\"center\">" + rowNumber + "</td>" +
                                                                                  "<td align=\"center\">" + inputHtml + "</td>" +
                                                                                   "<td align=\"center\">" + inputHtml + "</td>" +
                                                                                    "<td align=\"center\">" + inputHtml + "</td>" +
                                                                                   "<td align=\"center\">" + inputHtml + "</td>" +
                                                                                  "<td align=\"center\">" + inputHtml + "</td>" +
                                                                                  "<td align=\"center\">" + inputHtml + "</td>" +
                                                                             "</tr>");

                }
            },
            setTongDaoIdx: function (idx) {
                index = currentindex = idx;
            },
            getTongDaoIdx: function () {
                return index;
            },
            getCurTongDaoIdx: function (obj) {
                var id = $(obj).parents('table').eq(0).attr("id");
                currentindex = id.split('_')[2];
            }
        }
        var calculate = {
            wuCha: function (obj) {

                //【误差】=(【乘盘值】*序号-【实际值】)/实际值*100%，比允许误差多一位，四舍六入，逢五奇进偶不进
                TongDao.getCurTongDaoIdx(obj);
                var arry = this.getWuChaLength(obj);
                $("#tongdao_dy_" + currentindex + " tbody:eq(0) tr").each(function () {

                    var xuhao = $(this).children().eq(0).text();
                    //乘盘值
                    var chengpanzhi = $("#tongdao_dy_" + currentindex + " thead tr th:eq(1)").find("input").val();
                    //获取实际值
                    var shijizhi = $(this).children().eq(2).find('input').val();
                    //计算第一个误差
                    if (chengpanzhi != "" && shijizhi != "")
                        $(this).children().eq(3).find('input').val(fomatFloat(parseFloat((parseFloat(chengpanzhi) * parseFloat(xuhao) - parseFloat(shijizhi)) / parseFloat(shijizhi) * 100), arry[0].length + 1))
                    //计算第二个误差
                    chengpanzhi = $("#tongdao_dy_" + currentindex + " thead tr th:eq(2)").find("input").val();
                    shijizhi = $(this).children().eq(5).find('input').val();
                    if (chengpanzhi != "" && shijizhi != "")
                        $(this).children().eq(6).find('input').val(fomatFloat(parseFloat((parseFloat(chengpanzhi) * parseFloat(xuhao) - parseFloat(shijizhi)) / parseFloat(shijizhi) * 100), arry[0].length1 + 1))
                });

            },
            ShiJiZhi: function (obj) {
                //【实际值】=【乘盘值】*序号+【乘盘值】*10-5*【相对修正值(×10-6)】，四舍六入，逢五奇进偶不进
                //备注：小数位数保留规则： 乘盘值为*10，实际值小数位数为4位；乘盘值为*1，实际值小数位数为5位；乘盘值为*0.1，实际值小数位数为6位，以此类推"

                TongDao.getCurTongDaoIdx(obj);
                var arry = this.getChengPanZhiLength(obj);
                $("#tongdao_dy_" + currentindex + " tbody:eq(0) tr").each(function () {

                    var xuhao = $(this).children().eq(0).text();
                    //乘盘值
                    var chengpanzhi = $("#tongdao_dy_" + currentindex + " thead tr th:eq(1)").find("input").val();
                    //获取相对修正值
                    var xiuzhegnzhi = $(this).children().eq(1).find('input').val();
                    //计算第一个实际值
                    if (chengpanzhi != "" && xiuzhegnzhi != "")
                        $(this).children().eq(2).find('input').val(fomatFloat(parseFloat((parseFloat(chengpanzhi) * parseFloat(xuhao) + parseFloat(chengpanzhi) * Math.pow(10,-5) * xiuzhegnzhi)), arry[0].length))
                    //计算第二个误差
                    chengpanzhi = $("#tongdao_dy_" + currentindex + " thead tr th:eq(2)").find("input").val();
                    xiuzhegnzhi = $(this).children().eq(4).find('input').val();
                    if (chengpanzhi != "" && xiuzhegnzhi != "")
                        $(this).children().eq(5).find('input').val(fomatFloat(parseFloat((parseFloat(chengpanzhi) * parseFloat(xuhao) + parseFloat(chengpanzhi) * Math.pow(10, -5) * xiuzhegnzhi)), arry[0].length))
                });
                this.wuCha(obj);

            }, getWuChaLength: function (obj) {
                var arry = [];
                var tr = $(obj).parents('tr').eq(0);
                var yunxuWuCha = $("#tongdao_dy_" + currentindex + " tbody:eq(1) tr:eq(1) td:eq(2)").find("input").val();
                var yunxuWuCha1 = $("#tongdao_dy_" + currentindex + " tbody:eq(1) tr:eq(1) td:eq(4)").find("input").val();
                if (yunxuWuCha == "" && yunxuWuCha1 == "") {
                    arry.push({
                        length: 0,
                        length1: 0
                    });
                }
                else {
                    arry.push({
                        length: yunxuWuCha.split(".").length == 2 ? yunxuWuCha.split(".")[1].length : 0,
                        length1: yunxuWuCha1.split(".").length == 2 ? yunxuWuCha1.split(".")[1].length : 0
                    });
                }
                return arry;

            }, getChengPanZhiLength: function (obj) {
                var arry = [];
                var chengpanzhi = $("#tongdao_dy_" + currentindex + " thead tr th:eq(1)").find("input").val();
                var biaozhunLength = 4;
                if (!(parseFloat(chengpanzhi) % 10)) {
                    biaozhunLength = 4;
                }
                else {
                    var val = parseFloat(chengpanzhi) / 10
                    var data = val.toString().split(".");
                    if (data.length >= 1) {
                        biaozhunLength = biaozhunLength + data[1].length;
                    }
                }
                arry.push({
                    length: biaozhunLength
                })
                return arry;
            }
        }

    </script>
</body>
</html>
